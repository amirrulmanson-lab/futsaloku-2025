<!doctype html>
<html lang="ms" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jadual Perlawanan Futsal</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
   <div class="max-w-7xl mx-auto px-4 py-8">
    <header class="text-center mb-8">
     <h1 id="tournament-title" class="text-4xl font-bold text-white mb-2">Kejohanan Futsal Sukan OKU Karnival Parlimen Masjid Tanah 2025</h1><!-- Category Selection -->
     <div class="mt-6 flex justify-center gap-3"><button onclick="switchCategory('rendah')" id="btn-category-rendah" class="px-8 py-3 bg-white text-purple-700 font-bold rounded-lg shadow-lg hover:bg-gray-100 transition-colors text-lg"> üéØ Kategori Rendah </button> <button onclick="switchCategory('menengah')" id="btn-category-menengah" class="px-8 py-3 bg-purple-200 text-purple-700 font-bold rounded-lg shadow-lg hover:bg-purple-300 transition-colors text-lg"> üéØ Kategori Menengah </button>
     </div><!-- Navigation Buttons -->
     <div class="mt-6 flex justify-center gap-3 flex-wrap"><button onclick="showPage('standings')" id="btn-standings" class="px-6 py-3 bg-white text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition-colors"> ÔøΩÔøΩÔøΩÔøΩ Kedudukan Mata </button> <button onclick="showPage('schedule')" id="btn-schedule" class="px-6 py-3 bg-purple-200 text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-purple-300 transition-colors"> ÔøΩÔøΩ Jadual Masa </button> <button onclick="showPage('h2h')" id="btn-h2h" class="px-6 py-3 bg-purple-200 text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-purple-300 transition-colors"> ü§ù Head-to-Head </button> <button onclick="showPage('knockout')" id="btn-knockout" class="px-6 py-3 bg-purple-200 text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-purple-300 transition-colors"> üèÜ Peringkat Kalah Mati </button>
     </div>
     <div class="mt-4 flex justify-center gap-2"><button id="mode-toggle" onclick="toggleMode()" class="px-6 py-2 bg-white text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition-colors"> üë§ Mod Admin </button>
      <div id="mode-indicator" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-lg">
       üîí Mod Paparan
      </div>
     </div><!-- Modal Password -->
     <div id="password-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="margin: 0;">
      <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
       <h2 class="text-2xl font-bold mb-4 text-purple-700">üîê Login Admin</h2>
       <p class="text-gray-600 mb-4">Masukkan password untuk akses mod admin:</p><input type="password" id="password-input" placeholder="Password" class="w-full border-2 border-gray-300 rounded px-4 py-2 mb-4 focus:border-purple-500 focus:outline-none" onkeypress="if(event.key==='Enter') checkPassword()">
       <div id="error-message" class="text-red-500 text-sm mb-4 hidden">
        ‚ùå Password salah! Cuba lagi.
       </div>
       <div class="flex gap-2"><button onclick="checkPassword()" class="flex-1 bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 font-semibold"> Login </button> <button onclick="closePasswordModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 font-semibold"> Batal </button>
       </div>
       <p class="text-xs text-gray-500 mt-4">ÔøΩÔøΩ Hint: admin123</p>
      </div>
     </div>
    </header><!-- Page 1: Jadual Masa -->
    <div id="page-schedule" class="space-y-6 mb-8 hidden">
     <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 id="schedule-title" class="text-2xl font-bold mb-6 text-center text-purple-700">üïê Jadual Masa Perlawanan</h2><!-- Padang 1 -->
      <div class="mb-8">
       <h3 class="text-xl font-semibold mb-4 text-white bg-blue-600 px-4 py-2 rounded-lg">ÔøΩÔøΩ Padang 1</h3>
       <div id="schedule-padang1" class="space-y-2"></div>
      </div><!-- Padang 2 -->
      <div class="mb-8">
       <h3 class="text-xl font-semibold mb-4 text-white bg-green-600 px-4 py-2 rounded-lg">‚öΩ Padang 2</h3>
       <div id="schedule-padang2" class="space-y-2"></div>
      </div><!-- Nota -->
      <div class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
       <p class="text-sm text-gray-700"><strong>üìù Nota:</strong></p>
       <ul class="text-sm text-gray-600 mt-2 space-y-1 ml-4">
        <li>ÔøΩÔøΩÔøΩ Masa perlawanan: <strong>5 minit</strong></li>
        <li>‚Ä¢ Masa rehat: <strong>2 minit</strong></li>
        <li>‚Ä¢ Setiap pasukan ada rehat sebelum perlawanan seterusnya</li>
        <li>‚Ä¢ Pasukan akan bermain di kedua-dua padang</li>
       </ul>
      </div><!-- Kriteria Penentu Kedudukan -->
      <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
       <p class="text-sm text-gray-700"><strong>üèÖ Kriteria Penentu Kedudukan:</strong></p>
       <ol class="text-sm text-gray-600 mt-2 space-y-1 ml-4">
        <li><strong>1)</strong> Pungutan Mata</li>
        <li><strong>2)</strong> Beza Jaringan</li>
        <li><strong>3)</strong> Jumlah Jaringan</li>
        <li><strong>4)</strong> Head-to-Head (rekod pertemuan langsung)</li>
       </ol>
      </div>
     </div>
    </div><!-- Page 2: Kedudukan Mata -->
    <div id="page-standings" class="space-y-6 mb-8"><!-- Kumpulan A -->
     <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 id="group-a-title" class="text-2xl font-bold mb-4 text-purple-700">Kumpulan A</h2>
      <div id="standings-a" class="mb-6"></div>
      <h3 class="text-lg font-semibold mb-3 text-gray-700">Perlawanan</h3>
      <div id="matches-a" class="space-y-2"></div>
     </div><!-- Kumpulan B -->
     <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 id="group-b-title" class="text-2xl font-bold mb-4 text-purple-700">Kumpulan B</h2>
      <div id="standings-b" class="mb-6"></div>
      <h3 class="text-lg font-semibold mb-3 text-gray-700">Perlawanan</h3>
      <div id="matches-b" class="space-y-2"></div>
     </div><!-- Kumpulan C -->
     <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 id="group-c-title" class="text-2xl font-bold mb-4 text-purple-700">Kumpulan C</h2>
      <div id="standings-c" class="mb-6"></div>
      <h3 class="text-lg font-semibold mb-3 text-gray-700">Perlawanan</h3>
      <div id="matches-c" class="space-y-2"></div>
     </div>
    </div><!-- Page 3: Head-to-Head -->
    <div id="page-h2h" class="space-y-6 mb-8 hidden"><!-- Kumpulan A H2H -->
     <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-2xl font-bold mb-4 text-purple-700">Head-to-Head - Kumpulan A</h2>
      <div id="h2h-a"></div>
     </div><!-- Kumpulan B H2H -->
     <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-2xl font-bold mb-4 text-purple-700">Head-to-Head - Kumpulan B</h2>
      <div id="h2h-b"></div>
     </div><!-- Kumpulan C H2H -->
     <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-2xl font-bold mb-4 text-purple-700">Head-to-Head - Kumpulan C</h2>
      <div id="h2h-c"></div>
     </div>
    </div><!-- Page 4: Peringkat Kalah Mati -->
    <div id="page-knockout" class="space-y-6 mb-8 hidden">
     <div class="bg-white rounded-lg shadow-lg p-6">
      <div class="flex items-center justify-between mb-6">
       <div>
        <h2 class="text-2xl font-bold text-purple-700">ÔøΩÔøΩÔøΩ Peringkat Kalah Mati</h2>
        <p id="knockout-subtitle" class="text-sm text-gray-600 mt-1">Kategori Rendah bermula dari Suku Akhir</p>
       </div><button id="reset-knockout-btn" onclick="resetKnockoutMatches()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-semibold hidden"> üóëÔ∏è Reset Peringkat Kalah Mati </button>
      </div><!-- Quarter Final (Kategori Rendah sahaja) -->
      <div id="quarter-finals-section" class="mb-8">
       <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">Suku Akhir</h3>
       <div class="grid md:grid-cols-2 gap-4"><!-- Quarter Final 1 -->
        <div id="quarter1-container" class="border-2 border-blue-300 rounded-lg p-4 bg-blue-50">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-blue-700">
           Suku Akhir 1
          </div>
         </div>
         <div id="quarter1-info" class="text-xs text-center text-gray-600 mb-3">
          Johan A vs Tempat 3 Terbaik #2
         </div>
         <div id="quarter1-match"></div>
        </div><!-- Quarter Final 2 -->
        <div id="quarter2-container" class="border-2 border-blue-300 rounded-lg p-4 bg-blue-50">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-blue-700">
           Suku Akhir 2
          </div>
         </div>
         <div id="quarter2-info" class="text-xs text-center text-gray-600 mb-3">
          Johan B vs Tempat 3 Terbaik #1
         </div>
         <div id="quarter2-match"></div>
        </div><!-- Quarter Final 3 -->
        <div id="quarter3-container" class="border-2 border-blue-300 rounded-lg p-4 bg-blue-50">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-blue-700">
           Suku Akhir 3
          </div>
         </div>
         <div id="quarter3-info" class="text-xs text-center text-gray-600 mb-3">
          Johan C vs Naib Johan B
         </div>
         <div id="quarter3-match"></div>
        </div><!-- Quarter Final 4 -->
        <div id="quarter4-container" class="border-2 border-blue-300 rounded-lg p-4 bg-blue-50">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-blue-700">
           Suku Akhir 4
          </div>
         </div>
         <div id="quarter4-info" class="text-xs text-center text-gray-600 mb-3">
          Naib Johan A vs Naib Johan C
         </div>
         <div id="quarter4-match"></div>
        </div>
       </div>
      </div><!-- Semi Final -->
      <div class="mb-8">
       <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">Separuh Akhir</h3>
       <div class="grid md:grid-cols-2 gap-4"><!-- Semi Final 1 -->
        <div id="semi1-container" class="border-2 border-purple-300 rounded-lg p-4 bg-purple-50">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-purple-700">
           Separuh Akhir 1
          </div>
         </div>
         <div id="semi1-info" class="text-xs text-center text-gray-600 mb-3">
          Menang Suku Akhir 1 vs Menang Suku Akhir 2
         </div>
         <div id="semi1-match"></div>
        </div><!-- Semi Final 2 -->
        <div id="semi2-container" class="border-2 border-purple-300 rounded-lg p-4 bg-purple-50">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-purple-700">
           Separuh Akhir 2
          </div>
         </div>
         <div id="semi2-info" class="text-xs text-center text-gray-600 mb-3">
          Menang Suku Akhir 3 vs Menang Suku Akhir 4
         </div>
         <div id="semi2-match"></div>
        </div>
       </div>
      </div><!-- Third Place Playoff -->
      <div id="third-place-section" class="mb-8">
       <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">ü•â Perlawanan Tempat Ketiga</h3>
       <div class="max-w-2xl mx-auto">
        <div class="border-4 border-orange-400 rounded-lg p-6 bg-gradient-to-br from-orange-50 to-orange-100">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-orange-700">
           Tempat Ke-3 &amp; Ke-4
          </div>
         </div>
         <div id="third-place-info" class="text-xs text-center text-gray-600 mb-4">
          Kalah Separuh Akhir 1 vs Kalah Separuh Akhir 2
         </div>
         <div id="third-place-match"></div>
        </div>
       </div>
      </div><!-- Final -->
      <div class="mb-4">
       <h3 class="text-xl font-semibold mb-4 text-gray-700 text-center">üèÜ Akhir</h3>
       <div class="max-w-2xl mx-auto">
        <div class="border-4 border-yellow-400 rounded-lg p-6 bg-gradient-to-br from-yellow-50 to-yellow-100">
         <div class="flex justify-between items-center mb-3">
          <div class="text-sm font-semibold text-yellow-700">
           Perlawanan Akhir
          </div>
         </div>
         <div id="final-info" class="text-xs text-center text-gray-600 mb-4">
          Pemenang Separuh Akhir 1 vs Pemenang Separuh Akhir 2
         </div>
         <div id="final-match"></div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      tournament_title: "KEJOHANAN FUTSAL OKU KARNIVAL PARLIMEN MASJID TANAH",
      group_a_name: "Kumpulan A",
      group_b_name: "Kumpulan B",
      group_c_name: "Kumpulan C",
      team_1: "SUPERKIDS FC",
      team_2: "BILIMBIANZ FC",
      team_3: "BIDARIANS",
      team_4: "ELITE BROTHERS",
      team_5: "SK LESONG BATU",
      team_6: "YOUNG TIGERS",
      team_7: "SKDT PANTHERS",
      team_8: "TKRIMS",
      team_9: "PERTIWI FC",
      team_10: "DEMANG TAHA FC",
      team_11: "PPDK SERI PENGASIH",
      team_12: "D'NANING STRIKERS",
      primary_color: "#667eea",
      secondary_color: "#764ba2",
      surface_color: "#ffffff",
      text_color: "#374151",
      button_color: "#8b5cf6",
      font_family: "Poppins",
      font_size: 16
    };

    let currentPage = 'standings';
    let currentCategory = 'rendah';

    function switchCategory(category) {
      currentCategory = category;
      
      document.getElementById('btn-category-rendah').className = category === 'rendah'
        ? 'px-8 py-3 bg-white text-purple-700 font-bold rounded-lg shadow-lg hover:bg-gray-100 transition-colors text-lg'
        : 'px-8 py-3 bg-purple-200 text-purple-700 font-bold rounded-lg shadow-lg hover:bg-purple-300 transition-colors text-lg';
      
      document.getElementById('btn-category-menengah').className = category === 'menengah'
        ? 'px-8 py-3 bg-white text-purple-700 font-bold rounded-lg shadow-lg hover:bg-gray-100 transition-colors text-lg'
        : 'px-8 py-3 bg-purple-200 text-purple-700 font-bold rounded-lg shadow-lg hover:bg-purple-300 transition-colors text-lg';
      
      const knockoutSubtitle = document.getElementById('knockout-subtitle');
      if (knockoutSubtitle) {
        knockoutSubtitle.textContent = category === 'rendah' 
          ? '12 pasukan (4+4+4), bermula dari Suku Akhir'
          : '13 pasukan (5+4+4), bermula dari Suku Akhir';
      }
      
      renderAll();
    }

    function showPage(pageName) {
      document.getElementById('page-standings').classList.add('hidden');
      document.getElementById('page-schedule').classList.add('hidden');
      document.getElementById('page-h2h').classList.add('hidden');
      document.getElementById('page-knockout').classList.add('hidden');

      document.getElementById(`page-${pageName}`).classList.remove('hidden');

      document.getElementById('btn-standings').className = pageName === 'standings' 
        ? 'px-6 py-3 bg-white text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition-colors'
        : 'px-6 py-3 bg-purple-200 text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-purple-300 transition-colors';
      
      document.getElementById('btn-schedule').className = pageName === 'schedule' 
        ? 'px-6 py-3 bg-white text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition-colors'
        : 'px-6 py-3 bg-purple-200 text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-purple-300 transition-colors';
      
      document.getElementById('btn-h2h').className = pageName === 'h2h' 
        ? 'px-6 py-3 bg-white text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition-colors'
        : 'px-6 py-3 bg-purple-200 text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-purple-300 transition-colors';
      
      document.getElementById('btn-knockout').className = pageName === 'knockout' 
        ? 'px-6 py-3 bg-white text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-gray-100 transition-colors'
        : 'px-6 py-3 bg-purple-200 text-purple-700 font-semibold rounded-lg shadow-lg hover:bg-purple-300 transition-colors';

      currentPage = pageName;
    }

    function getTeamName(idx, config) {
      if (currentCategory === 'menengah') {
        const menengahTeamsA = [
          'ADE PUTRA',
          'KASTURI B',
          'SERI SOCCER',
          'SMKKT',
          'D\'NAISS'
        ];
        
        const menengahTeamsB = [
          'KASTURI A',
          'STARIM UNITED B',
          'MALINDO TEAM',
          'LUNASS FC'
        ];
        
        const menengahTeamsC = [
          'STARIM UNITED A',
          'KASTURI C',
          'SMK SUNGAI UDANG',
          'SEMERAH'
        ];
        
        if (idx <= 4) return menengahTeamsA[idx];
        if (idx >= 5 && idx <= 8) return menengahTeamsB[idx - 5];
        if (idx >= 9 && idx <= 12) return menengahTeamsC[idx - 9];
      }
      return config[`team_${idx + 1}`] || defaultConfig[`team_${idx + 1}`];
    }

    const matchesRendahA = [
      { id: 'A-0-1', team1Idx: 0, team2Idx: 1, group: 'A' },
      { id: 'A-2-3', team1Idx: 2, team2Idx: 3, group: 'A' },
      { id: 'A-0-2', team1Idx: 0, team2Idx: 2, group: 'A' },
      { id: 'A-1-3', team1Idx: 1, team2Idx: 3, group: 'A' },
      { id: 'A-0-3', team1Idx: 0, team2Idx: 3, group: 'A' },
      { id: 'A-1-2', team1Idx: 1, team2Idx: 2, group: 'A' }
    ];
    
    const matchesRendahB = [
      { id: 'B-0-1', team1Idx: 4, team2Idx: 5, group: 'B' },
      { id: 'B-2-3', team1Idx: 6, team2Idx: 7, group: 'B' },
      { id: 'B-0-2', team1Idx: 4, team2Idx: 6, group: 'B' },
      { id: 'B-1-3', team1Idx: 5, team2Idx: 7, group: 'B' },
      { id: 'B-0-3', team1Idx: 4, team2Idx: 7, group: 'B' },
      { id: 'B-1-2', team1Idx: 5, team2Idx: 6, group: 'B' }
    ];
    
    const matchesRendahC = [
      { id: 'C-0-1', team1Idx: 8, team2Idx: 9, group: 'C' },
      { id: 'C-2-3', team1Idx: 10, team2Idx: 11, group: 'C' },
      { id: 'C-0-2', team1Idx: 8, team2Idx: 10, group: 'C' },
      { id: 'C-1-3', team1Idx: 9, team2Idx: 11, group: 'C' },
      { id: 'C-0-3', team1Idx: 8, team2Idx: 11, group: 'C' },
      { id: 'C-1-2', team1Idx: 9, team2Idx: 10, group: 'C' }
    ];

    const matchesMenengahA = [
      { id: 'A-0-1', team1Idx: 0, team2Idx: 1, group: 'A' },
      { id: 'A-2-3', team1Idx: 2, team2Idx: 3, group: 'A' },
      { id: 'A-0-2', team1Idx: 0, team2Idx: 2, group: 'A' },
      { id: 'A-1-3', team1Idx: 1, team2Idx: 3, group: 'A' },
      { id: 'A-0-3', team1Idx: 0, team2Idx: 3, group: 'A' },
      { id: 'A-1-2', team1Idx: 1, team2Idx: 2, group: 'A' },
      { id: 'A-0-4', team1Idx: 0, team2Idx: 4, group: 'A' },
      { id: 'A-1-4', team1Idx: 1, team2Idx: 4, group: 'A' },
      { id: 'A-2-4', team1Idx: 2, team2Idx: 4, group: 'A' },
      { id: 'A-3-4', team1Idx: 3, team2Idx: 4, group: 'A' }
    ];
    
    const matchesMenengahB = [
      { id: 'B-0-1', team1Idx: 5, team2Idx: 6, group: 'B' },
      { id: 'B-2-3', team1Idx: 7, team2Idx: 8, group: 'B' },
      { id: 'B-0-2', team1Idx: 5, team2Idx: 7, group: 'B' },
      { id: 'B-1-3', team1Idx: 6, team2Idx: 8, group: 'B' },
      { id: 'B-0-3', team1Idx: 5, team2Idx: 8, group: 'B' },
      { id: 'B-1-2', team1Idx: 6, team2Idx: 7, group: 'B' }
    ];
    
    const matchesMenengahC = [
      { id: 'C-0-1', team1Idx: 9, team2Idx: 10, group: 'C' },
      { id: 'C-2-3', team1Idx: 11, team2Idx: 12, group: 'C' },
      { id: 'C-0-2', team1Idx: 9, team2Idx: 11, group: 'C' },
      { id: 'C-1-3', team1Idx: 10, team2Idx: 12, group: 'C' },
      { id: 'C-0-3', team1Idx: 9, team2Idx: 12, group: 'C' },
      { id: 'C-1-2', team1Idx: 10, team2Idx: 11, group: 'C' }
    ];

    let matchScores = new Map();
    let isAdminMode = false;
    let isAuthenticated = false;
    const ADMIN_PASSWORD = "admin123";

    function getMatchId(matchId) {
      return `${currentCategory}-${matchId}`;
    }

    function calculateStandings(teamIndices, matches, scoresMap, config) {
      const standings = teamIndices.map(idx => ({
        team: getTeamName(idx, config),
        teamIdx: idx,
        played: 0,
        won: 0,
        drawn: 0,
        lost: 0,
        gf: 0,
        ga: 0,
        gd: 0,
        points: 0,
        group: matches.length > 0 ? matches[0].id.split('-')[0] : ''
      }));

      matches.forEach(match => {
        const score = scoresMap.get(getMatchId(match.id));
        if (score && score.team1_score !== null && score.team2_score !== null) {
          const team1Stats = standings.find(s => s.teamIdx === match.team1Idx);
          const team2Stats = standings.find(s => s.teamIdx === match.team2Idx);

          team1Stats.played++;
          team2Stats.played++;
          team1Stats.gf += score.team1_score;
          team1Stats.ga += score.team2_score;
          team2Stats.gf += score.team2_score;
          team2Stats.ga += score.team1_score;

          if (score.team1_score > score.team2_score) {
            team1Stats.won++;
            team1Stats.points += 3;
            team2Stats.lost++;
          } else if (score.team1_score < score.team2_score) {
            team2Stats.won++;
            team2Stats.points += 3;
            team1Stats.lost++;
          } else {
            team1Stats.drawn++;
            team2Stats.drawn++;
            team1Stats.points++;
            team2Stats.points++;
          }

          team1Stats.gd = team1Stats.gf - team1Stats.ga;
          team2Stats.gd = team2Stats.gf - team2Stats.ga;
        }
      });

      function getHeadToHead(teamIdx1, teamIdx2) {
        const match = matches.find(m => 
          (m.team1Idx === teamIdx1 && m.team2Idx === teamIdx2) ||
          (m.team1Idx === teamIdx2 && m.team2Idx === teamIdx1)
        );
        
        if (!match) return null;
        
        const score = scoresMap.get(getMatchId(match.id));
        if (!score || score.team1_score === null || score.team2_score === null) return null;
        
        if (match.team1Idx === teamIdx1) {
          return {
            for: score.team1_score,
            against: score.team2_score
          };
        } else {
          return {
            for: score.team2_score,
            against: score.team1_score
          };
        }
      }

      standings.sort((a, b) => {
        // 1) Pungutan mata
        if (b.points !== a.points) return b.points - a.points;
        
        // 2) Beza jaringan
        if (b.gd !== a.gd) return b.gd - a.gd;
        
        // 3) Jumlah jaringan
        if (b.gf !== a.gf) return b.gf - a.gf;
        
        // 4) Head-to-head
        const h2h = getHeadToHead(a.teamIdx, b.teamIdx);
        if (h2h) {
          if (h2h.for > h2h.against) return -1;
          if (h2h.for < h2h.against) return 1;
        }
        
        return 0;
      });

      return standings;
    }

    function getQualifiedTeams() {
      const { matchesA, matchesB, matchesC } = getCurrentMatches();
      
      if (currentCategory === 'rendah') {
        const teamIndicesA = [0, 1, 2, 3];
        const teamIndicesB = [4, 5, 6, 7];
        const teamIndicesC = [8, 9, 10, 11];
        
        const config = window.elementSdk?.config || defaultConfig;
        const standingsA = calculateStandings(teamIndicesA, matchesA, matchScores, config);
        const standingsB = calculateStandings(teamIndicesB, matchesB, matchScores, config);
        const standingsC = calculateStandings(teamIndicesC, matchesC, matchScores, config);
        
        const johanA = standingsA[0]?.team || 'Johan A';
        const naibJohanA = standingsA[1]?.team || 'Naib Johan A';
        const johanB = standingsB[0]?.team || 'Johan B';
        const naibJohanB = standingsB[1]?.team || 'Naib Johan B';
        const johanC = standingsC[0]?.team || 'Johan C';
        const naibJohanC = standingsC[1]?.team || 'Naib Johan C';
        
        const third3A = { ...standingsA[2], group: 'A' };
        const third3B = { ...standingsB[2], group: 'B' };
        const third3C = { ...standingsC[2], group: 'C' };
        
        const allThirds = [third3A, third3B, third3C].filter(t => t.team);
        allThirds.sort((a, b) => {
          if (b.points !== a.points) return b.points - a.points;
          if (b.gd !== a.gd) return b.gd - a.gd;
          if (b.gf !== a.gf) return b.gf - a.gf;
          return 0;
        });
        
        const best3rd1 = allThirds[0]?.team || 'Tempat 3 Terbaik #1';
        const best3rd2 = allThirds[1]?.team || 'Tempat 3 Terbaik #2';
        
        return {
          johanA, naibJohanA,
          johanB, naibJohanB,
          johanC, naibJohanC,
          best3rd1, best3rd2
        };
      } else {
        const teamIndicesA = [0, 1, 2, 3, 4];
        const teamIndicesB = [5, 6, 7, 8];
        const teamIndicesC = [9, 10, 11, 12];
        
        const config = window.elementSdk?.config || defaultConfig;
        const standingsA = calculateStandings(teamIndicesA, matchesMenengahA, matchScores, config);
        const standingsB = calculateStandings(teamIndicesB, matchesMenengahB, matchScores, config);
        const standingsC = calculateStandings(teamIndicesC, matchesMenengahC, matchScores, config);
        
        const johanA = standingsA[0]?.team || 'Johan A';
        const naibJohanA = standingsA[1]?.team || 'Naib Johan A';
        const johanB = standingsB[0]?.team || 'Johan B';
        const naibJohanB = standingsB[1]?.team || 'Naib Johan B';
        const johanC = standingsC[0]?.team || 'Johan C';
        const naibJohanC = standingsC[1]?.team || 'Naib Johan C';
        
        const third3A = { ...standingsA[2], group: 'A' };
        const third3B = { ...standingsB[2], group: 'B' };
        const third3C = { ...standingsC[2], group: 'C' };
        
        const allThirds = [third3A, third3B, third3C].filter(t => t.team);
        allThirds.sort((a, b) => {
          if (b.points !== a.points) return b.points - a.points;
          if (b.gd !== a.gd) return b.gd - a.gd;
          if (b.gf !== a.gf) return b.gf - a.gf;
          return 0;
        });
        
        const best3rd1 = allThirds[0]?.team || 'Tempat 3 Terbaik #1';
        const best3rd2 = allThirds[1]?.team || 'Tempat 3 Terbaik #2';
        
        return {
          johanA, naibJohanA,
          johanB, naibJohanB,
          johanC, naibJohanC,
          best3rd1, best3rd2
        };
      }
    }

    function renderStandings(containerId, teamIndices, matches) {
      const container = document.getElementById(containerId);
      const config = window.elementSdk?.config || defaultConfig;
      const standings = calculateStandings(teamIndices, matches, matchScores, config);
      const baseSize = config.font_size || defaultConfig.font_size;
      const textColor = config.text_color || defaultConfig.text_color;
      
      container.innerHTML = `
        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b-2" style="color: ${textColor}; font-size: ${baseSize * 0.85}px;">
                <th class="text-left py-2 px-2">#</th>
                <th class="text-left py-2 px-2">Pasukan</th>
                <th class="text-center py-2 px-1">P</th>
                <th class="text-center py-2 px-1">M</th>
                <th class="text-center py-2 px-1">S</th>
                <th class="text-center py-2 px-1">K</th>
                <th class="text-center py-2 px-1">JG</th>
                <th class="text-center py-2 px-1">BG</th>
                <th class="text-center py-2 px-1">PG</th>
                <th class="text-center py-2 px-1 font-bold">Pts</th>
              </tr>
            </thead>
            <tbody>
              ${standings.map((team, index) => `
                <tr class="border-b" style="color: ${textColor}; font-size: ${baseSize * 0.9}px;">
                  <td class="py-2 px-2 font-semibold">${index + 1}</td>
                  <td class="py-2 px-2">${team.team}</td>
                  <td class="text-center py-2 px-1">${team.played}</td>
                  <td class="text-center py-2 px-1">${team.won}</td>
                  <td class="text-center py-2 px-1">${team.drawn}</td>
                  <td class="text-center py-2 px-1">${team.lost}</td>
                  <td class="text-center py-2 px-1">${team.gf}</td>
                  <td class="text-center py-2 px-1">${team.ga}</td>
                  <td class="text-center py-2 px-1">${team.gd >= 0 ? '+' : ''}${team.gd}</td>
                  <td class="text-center py-2 px-1 font-bold">${team.points}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function renderHeadToHead(containerId, teamIndices, matches) {
      const container = document.getElementById(containerId);
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const textColor = config.text_color || defaultConfig.text_color;
      
      const matrix = {};
      teamIndices.forEach(idx1 => {
        matrix[idx1] = {};
        teamIndices.forEach(idx2 => {
          if (idx1 !== idx2) {
            matrix[idx1][idx2] = null;
          }
        });
      });

      matches.forEach(match => {
        const score = matchScores.get(getMatchId(match.id));
        if (score && score.team1_score !== null && score.team2_score !== null) {
          matrix[match.team1Idx][match.team2Idx] = {
            for: score.team1_score,
            against: score.team2_score
          };
          matrix[match.team2Idx][match.team1Idx] = {
            for: score.team2_score,
            against: score.team1_score
          };
        }
      });

      const shortNames = teamIndices.map(idx => {
        const fullName = getTeamName(idx, config);
        return fullName.substring(0, 3).toUpperCase();
      });
      
      container.innerHTML = `
        <div class="overflow-x-auto">
          <table class="w-full text-xs border-collapse">
            <thead>
              <tr style="color: ${textColor}; font-size: ${baseSize * 0.75}px;">
                <th class="border p-1 bg-gray-100"></th>
                ${shortNames.map(name => `<th class="border p-1 bg-gray-100 text-center">${name}</th>`).join('')}
              </tr>
            </thead>
            <tbody>
              ${teamIndices.map((teamIdx1, idx1) => `
                <tr style="color: ${textColor}; font-size: ${baseSize * 0.75}px;">
                  <td class="border p-1 bg-gray-100 font-semibold">${shortNames[idx1]}</td>
                  ${teamIndices.map((teamIdx2, idx2) => {
                    if (idx1 === idx2) {
                      return `<td class="border p-1 bg-gray-200 text-center">-</td>`;
                    }
                    const result = matrix[teamIdx1][teamIdx2];
                    if (result) {
                      const won = result.for > result.against;
                      const drawn = result.for === result.against;
                      const bgColor = won ? '#d4edda' : drawn ? '#fff3cd' : '#f8d7da';
                      return `<td class="border p-1 text-center font-semibold" style="background-color: ${bgColor};">${result.for}-${result.against}</td>`;
                    }
                    return `<td class="border p-1 text-center text-gray-400">-</td>`;
                  }).join('')}
                </tr>
              `).join('')}
            </tbody>
          </table>
          <div class="mt-2 text-xs" style="color: ${textColor}; font-size: ${baseSize * 0.7}px;">
            <span class="inline-block px-2 py-0.5 mr-2" style="background-color: #d4edda;">Menang</span>
            <span class="inline-block px-2 py-0.5 mr-2" style="background-color: #fff3cd;">Seri</span>
            <span class="inline-block px-2 py-0.5" style="background-color: #f8d7da;">Kalah</span>
          </div>
        </div>
      `;
    }

    function renderMatches(containerId, matches) {
      const container = document.getElementById(containerId);
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const buttonColor = config.button_color || defaultConfig.button_color;
      const textColor = config.text_color || defaultConfig.text_color;
      
      container.innerHTML = matches.map((match, index) => {
        const score = matchScores.get(getMatchId(match.id));
        const team1Score = score?.team1_score ?? '';
        const team2Score = score?.team2_score ?? '';
        const hasScore = team1Score !== '' && team2Score !== '';
        const team1Name = getTeamName(match.team1Idx, config);
        const team2Name = getTeamName(match.team2Idx, config);
        
        if (isAdminMode) {
          return `
            <div class="border rounded-lg p-3 bg-gray-50">
              <div class="flex items-center justify-between gap-2">
                <div class="flex-1 text-right" style="color: ${textColor}; font-size: ${baseSize * 0.9}px;">${team1Name}</div>
                <div class="flex items-center gap-2">
                  <input type="number" 
                    id="score-${match.id}-1" 
                    value="${team1Score}" 
                    placeholder="0"
                    min="0"
                    class="w-12 text-center border rounded px-2 py-1"
                    style="font-size: ${baseSize}px;">
                  <span style="color: ${textColor}; font-size: ${baseSize}px;">-</span>
                  <input type="number" 
                    id="score-${match.id}-2" 
                    value="${team2Score}" 
                    placeholder="0"
                    min="0"
                    class="w-12 text-center border rounded px-2 py-1"
                    style="font-size: ${baseSize}px;">
                </div>
                <div class="flex-1" style="color: ${textColor}; font-size: ${baseSize * 0.9}px;">${team2Name}</div>
                <button 
                  onclick="saveScore('${match.id}')" 
                  id="btn-${match.id}"
                  class="px-3 py-1 text-white rounded hover:opacity-90 transition-opacity"
                  style="background-color: ${buttonColor}; font-size: ${baseSize * 0.85}px; min-width: 70px;">
                  ${hasScore ? 'Kemaskini' : 'Simpan'}
                </button>
              </div>
            </div>
          `;
        } else {
          const displayScore1 = team1Score === '' ? '-' : team1Score;
          const displayScore2 = team2Score === '' ? '-' : team2Score;
          return `
            <div class="border rounded-lg p-3 bg-gray-50">
              <div class="flex items-center justify-center gap-2">
                <div class="flex-1 text-right font-semibold" style="color: ${textColor}; font-size: ${baseSize * 0.9}px;">${team1Name}</div>
                <div class="flex items-center gap-2 px-4 py-2 bg-white rounded border-2" style="min-width: 80px;">
                  <span class="font-bold text-center flex-1" style="color: ${textColor}; font-size: ${baseSize * 1.2}px;">${displayScore1}</span>
                  <span style="color: ${textColor}; font-size: ${baseSize}px;">-</span>
                  <span class="font-bold text-center flex-1" style="color: ${textColor}; font-size: ${baseSize * 1.2}px;">${displayScore2}</span>
                </div>
                <div class="flex-1 font-semibold" style="color: ${textColor}; font-size: ${baseSize * 0.9}px;">${team2Name}</div>
              </div>
            </div>
          `;
        }
      }).join('');
    }

    function renderKnockoutMatch(containerId, matchId, defaultTeam1, defaultTeam2) {
      const container = document.getElementById(containerId);
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const buttonColor = config.button_color || defaultConfig.button_color;
      const textColor = config.text_color || defaultConfig.text_color;
      
      const { matchesA, matchesB, matchesC } = getCurrentMatches();
      const allMatches = currentCategory === 'rendah' 
        ? [...matchesA, ...matchesB, ...matchesC]
        : [...matchesA, ...matchesB];
      
      const allGroupMatchesComplete = allMatches.every(match => {
        const score = matchScores.get(getMatchId(match.id));
        return score && score.team1_score !== null && score.team2_score !== null;
      });
      
      const qualified = getQualifiedTeams();
      
      let actualTeam1 = allGroupMatchesComplete ? '' : defaultTeam1;
      let actualTeam2 = allGroupMatchesComplete ? '' : defaultTeam2;
      
      if (currentCategory === 'rendah') {
        if (matchId === 'QUARTER-1') {
          actualTeam1 = allGroupMatchesComplete ? qualified.johanA : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.best3rd2 : defaultTeam2;
        } else if (matchId === 'QUARTER-2') {
          actualTeam1 = allGroupMatchesComplete ? qualified.johanB : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.best3rd1 : defaultTeam2;
        } else if (matchId === 'QUARTER-3') {
          actualTeam1 = allGroupMatchesComplete ? qualified.johanC : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.naibJohanB : defaultTeam2;
        } else if (matchId === 'QUARTER-4') {
          actualTeam1 = allGroupMatchesComplete ? qualified.naibJohanA : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.naibJohanC : defaultTeam2;
        } else if (matchId === 'SEMI-1') {
          const q1Score = matchScores.get(getMatchId('QUARTER-1'));
          const q2Score = matchScores.get(getMatchId('QUARTER-2'));
          const q1Complete = q1Score && q1Score.team1_score !== null && q1Score.team2_score !== null;
          const q2Complete = q2Score && q2Score.team1_score !== null && q2Score.team2_score !== null;
          
          if (q1Complete && q1Score.team1_name && q1Score.team2_name) {
            actualTeam1 = q1Score.team1_score > q1Score.team2_score ? q1Score.team1_name : q1Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (q2Complete && q2Score.team1_name && q2Score.team2_name) {
            actualTeam2 = q2Score.team1_score > q2Score.team2_score ? q2Score.team1_name : q2Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        } else if (matchId === 'SEMI-2') {
          const q3Score = matchScores.get(getMatchId('QUARTER-3'));
          const q4Score = matchScores.get(getMatchId('QUARTER-4'));
          const q3Complete = q3Score && q3Score.team1_score !== null && q3Score.team2_score !== null;
          const q4Complete = q4Score && q4Score.team1_score !== null && q4Score.team2_score !== null;
          
          if (q3Complete && q3Score.team1_name && q3Score.team2_name) {
            actualTeam1 = q3Score.team1_score > q3Score.team2_score ? q3Score.team1_name : q3Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (q4Complete && q4Score.team1_name && q4Score.team2_name) {
            actualTeam2 = q4Score.team1_score > q4Score.team2_score ? q4Score.team1_name : q4Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        } else if (matchId === 'THIRD-PLACE') {
          const s1Score = matchScores.get(getMatchId('SEMI-1'));
          const s2Score = matchScores.get(getMatchId('SEMI-2'));
          const s1Complete = s1Score && s1Score.team1_score !== null && s1Score.team2_score !== null;
          const s2Complete = s2Score && s2Score.team1_score !== null && s2Score.team2_score !== null;
          
          if (s1Complete && s1Score.team1_name && s1Score.team2_name) {
            actualTeam1 = s1Score.team1_score < s1Score.team2_score ? s1Score.team1_name : s1Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (s2Complete && s2Score.team1_name && s2Score.team2_name) {
            actualTeam2 = s2Score.team1_score < s2Score.team2_score ? s2Score.team1_name : s2Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        } else if (matchId === 'FINAL') {
          const s1Score = matchScores.get(getMatchId('SEMI-1'));
          const s2Score = matchScores.get(getMatchId('SEMI-2'));
          const s1Complete = s1Score && s1Score.team1_score !== null && s1Score.team2_score !== null;
          const s2Complete = s2Score && s2Score.team1_score !== null && s2Score.team2_score !== null;
          
          if (s1Complete && s1Score.team1_name && s1Score.team2_name) {
            actualTeam1 = s1Score.team1_score > s1Score.team2_score ? s1Score.team1_name : s1Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (s2Complete && s2Score.team1_name && s2Score.team2_name) {
            actualTeam2 = s2Score.team1_score > s2Score.team2_score ? s2Score.team1_name : s2Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        }
      } else {
        if (matchId === 'QUARTER-1') {
          actualTeam1 = allGroupMatchesComplete ? qualified.johanA : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.best3rd1 : defaultTeam2;
        } else if (matchId === 'QUARTER-2') {
          actualTeam1 = allGroupMatchesComplete ? qualified.johanB : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.naibJohanC : defaultTeam2;
        } else if (matchId === 'QUARTER-3') {
          actualTeam1 = allGroupMatchesComplete ? qualified.johanC : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.naibJohanB : defaultTeam2;
        } else if (matchId === 'QUARTER-4') {
          actualTeam1 = allGroupMatchesComplete ? qualified.naibJohanA : defaultTeam1;
          actualTeam2 = allGroupMatchesComplete ? qualified.best3rd2 : defaultTeam2;
        } else if (matchId === 'SEMI-1') {
          const q1Score = matchScores.get(getMatchId('QUARTER-1'));
          const q2Score = matchScores.get(getMatchId('QUARTER-2'));
          const q1Complete = q1Score && q1Score.team1_score !== null && q1Score.team2_score !== null;
          const q2Complete = q2Score && q2Score.team1_score !== null && q2Score.team2_score !== null;
          
          if (q1Complete && q1Score.team1_name && q1Score.team2_name) {
            actualTeam1 = q1Score.team1_score > q1Score.team2_score ? q1Score.team1_name : q1Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (q2Complete && q2Score.team1_name && q2Score.team2_name) {
            actualTeam2 = q2Score.team1_score > q2Score.team2_score ? q2Score.team1_name : q2Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        } else if (matchId === 'SEMI-2') {
          const q3Score = matchScores.get(getMatchId('QUARTER-3'));
          const q4Score = matchScores.get(getMatchId('QUARTER-4'));
          const q3Complete = q3Score && q3Score.team1_score !== null && q3Score.team2_score !== null;
          const q4Complete = q4Score && q4Score.team1_score !== null && q4Score.team2_score !== null;
          
          if (q3Complete && q3Score.team1_name && q3Score.team2_name) {
            actualTeam1 = q3Score.team1_score > q3Score.team2_score ? q3Score.team1_name : q3Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (q4Complete && q4Score.team1_name && q4Score.team2_name) {
            actualTeam2 = q4Score.team1_score > q4Score.team2_score ? q4Score.team1_name : q4Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        } else if (matchId === 'THIRD-PLACE') {
          const s1Score = matchScores.get(getMatchId('SEMI-1'));
          const s2Score = matchScores.get(getMatchId('SEMI-2'));
          const s1Complete = s1Score && s1Score.team1_score !== null && s1Score.team2_score !== null;
          const s2Complete = s2Score && s2Score.team1_score !== null && s2Score.team2_score !== null;
          
          if (s1Complete && s1Score.team1_name && s1Score.team2_name) {
            actualTeam1 = s1Score.team1_score < s1Score.team2_score ? s1Score.team1_name : s1Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (s2Complete && s2Score.team1_name && s2Score.team2_name) {
            actualTeam2 = s2Score.team1_score < s2Score.team2_score ? s2Score.team1_name : s2Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        } else if (matchId === 'FINAL') {
          const s1Score = matchScores.get(getMatchId('SEMI-1'));
          const s2Score = matchScores.get(getMatchId('SEMI-2'));
          const s1Complete = s1Score && s1Score.team1_score !== null && s1Score.team2_score !== null;
          const s2Complete = s2Score && s2Score.team1_score !== null && s2Score.team2_score !== null;
          
          if (s1Complete && s1Score.team1_name && s1Score.team2_name) {
            actualTeam1 = s1Score.team1_score > s1Score.team2_score ? s1Score.team1_name : s1Score.team2_name;
          } else {
            actualTeam1 = defaultTeam1;
          }
          
          if (s2Complete && s2Score.team1_name && s2Score.team2_name) {
            actualTeam2 = s2Score.team1_score > s2Score.team2_score ? s2Score.team1_name : s2Score.team2_name;
          } else {
            actualTeam2 = defaultTeam2;
          }
        }
      }
      
      const score = matchScores.get(getMatchId(matchId));
      const team1Name = score?.team1_name || actualTeam1;
      const team2Name = score?.team2_name || actualTeam2;
      const team1Score = score?.team1_score ?? '';
      const team2Score = score?.team2_score ?? '';
      const hasScore = team1Score !== '' && team2Score !== '';
      
      if (isAdminMode) {
        container.innerHTML = `
          <div class="space-y-3">
            <div class="flex gap-2">
              <input type="text" 
                id="team-${matchId}-1" 
                value="${team1Name}" 
                placeholder="Nama Pasukan 1"
                class="flex-1 border rounded px-3 py-2"
                style="font-size: ${baseSize * 0.9}px;">
            </div>
            <div class="flex gap-2">
              <input type="text" 
                id="team-${matchId}-2" 
                value="${team2Name}" 
                placeholder="Nama Pasukan 2"
                class="flex-1 border rounded px-3 py-2"
                style="font-size: ${baseSize * 0.9}px;">
            </div>
            <div class="flex items-center justify-center gap-3">
              <input type="number" 
                id="score-${matchId}-1" 
                value="${team1Score}" 
                placeholder="0"
                min="0"
                class="w-16 text-center border rounded px-2 py-2 text-lg font-bold"
                style="font-size: ${baseSize * 1.1}px;">
              <span style="color: ${textColor}; font-size: ${baseSize * 1.2}px;" class="font-bold">VS</span>
              <input type="number" 
                id="score-${matchId}-2" 
                value="${team2Score}" 
                placeholder="0"
                min="0"
                class="w-16 text-center border rounded px-2 py-2 text-lg font-bold"
                style="font-size: ${baseSize * 1.1}px;">
            </div>
            <button 
              onclick="saveKnockoutScore('${matchId}')" 
              id="btn-${matchId}"
              class="w-full px-4 py-2 text-white rounded hover:opacity-90 transition-opacity font-semibold"
              style="background-color: ${buttonColor}; font-size: ${baseSize * 0.9}px;">
              ${hasScore ? 'Kemaskini Keputusan' : 'Simpan Keputusan'}
            </button>
          </div>
        `;
      } else {
        const displayScore1 = team1Score === '' ? '-' : team1Score;
        const displayScore2 = team2Score === '' ? '-' : team2Score;
        const winner = hasScore && team1Score !== team2Score 
          ? (team1Score > team2Score ? team1Name : team2Name) 
          : null;
        
        container.innerHTML = `
          <div class="space-y-3">
            <div class="text-center font-semibold" style="color: ${textColor}; font-size: ${baseSize}px;">${team1Name}</div>
            <div class="flex items-center justify-center gap-3 py-3 bg-white rounded-lg border-2">
              <span class="font-bold text-2xl" style="color: ${textColor}; font-size: ${baseSize * 1.5}px;">${displayScore1}</span>
              <span style="color: ${textColor}; font-size: ${baseSize}px;" class="font-bold">VS</span>
              <span class="font-bold text-2xl" style="color: ${textColor}; font-size: ${baseSize * 1.5}px;">${displayScore2}</span>
            </div>
            <div class="text-center font-semibold" style="color: ${textColor}; font-size: ${baseSize}px;">${team2Name}</div>
            ${winner ? `<div class="text-center mt-2 px-3 py-2 bg-green-100 rounded-lg"><span style="color: #059669; font-size: ${baseSize * 0.9}px;" class="font-bold">üèÜ Pemenang: ${winner}</span></div>` : ''}
          </div>
        `;
      }
    }

    async function saveScore(matchId) {
      const score1Input = document.getElementById(`score-${matchId}-1`);
      const score2Input = document.getElementById(`score-${matchId}-2`);
      const saveBtn = document.getElementById(`btn-${matchId}`);
      
      if (!score1Input || !score2Input || !saveBtn) {
        console.error('Input elements not found');
        return;
      }
      
      const score1 = score1Input.value === '' ? null : parseInt(score1Input.value);
      const score2 = score2Input.value === '' ? null : parseInt(score2Input.value);

      if (score1 === null || score2 === null || isNaN(score1) || isNaN(score2)) {
        alert('Sila masukkan markah yang sah untuk kedua-dua pasukan');
        return;
      }

      if (score1 < 0 || score2 < 0) {
        alert('Markah tidak boleh negatif');
        return;
      }

      score1Input.disabled = true;
      score2Input.disabled = true;
      saveBtn.disabled = true;
      saveBtn.textContent = 'Menyimpan...';

      const existingScore = matchScores.get(getMatchId(matchId));
      
      try {
        if (existingScore && existingScore.__backendId) {
          const result = await window.dataSdk.update({
            ...existingScore,
            team1_score: score1,
            team2_score: score2
          });
          
          if (!result.isOk) {
            console.error('Failed to update score:', result.error);
            alert('Gagal mengemaskini markah. Sila cuba lagi.');
            score1Input.disabled = false;
            score2Input.disabled = false;
            saveBtn.disabled = false;
            saveBtn.textContent = 'Kemaskini';
          }
        } else {
          const result = await window.dataSdk.create({
            match_id: getMatchId(matchId),
            category: currentCategory,
            team1_score: score1,
            team2_score: score2
          });
          
          if (!result.isOk) {
            console.error('Failed to create score:', result.error);
            alert('Gagal menyimpan markah. Sila cuba lagi.');
            score1Input.disabled = false;
            score2Input.disabled = false;
            saveBtn.disabled = false;
            saveBtn.textContent = 'Simpan';
          }
        }
      } catch (error) {
        console.error('Error saving score:', error);
        alert('Ralat berlaku semasa menyimpan markah');
        score1Input.disabled = false;
        score2Input.disabled = false;
        saveBtn.disabled = false;
        saveBtn.textContent = existingScore ? 'Kemaskini' : 'Simpan';
      }
    }

    async function saveKnockoutScore(matchId) {
      const team1Input = document.getElementById(`team-${matchId}-1`);
      const team2Input = document.getElementById(`team-${matchId}-2`);
      const score1Input = document.getElementById(`score-${matchId}-1`);
      const score2Input = document.getElementById(`score-${matchId}-2`);
      const saveBtn = document.getElementById(`btn-${matchId}`);
      
      if (!team1Input || !team2Input || !score1Input || !score2Input || !saveBtn) {
        console.error('Input elements not found');
        return;
      }
      
      const team1Name = team1Input.value.trim();
      const team2Name = team2Input.value.trim();
      const score1 = score1Input.value === '' ? null : parseInt(score1Input.value);
      const score2 = score2Input.value === '' ? null : parseInt(score2Input.value);

      if (!team1Name || !team2Name) {
        alert('Sila masukkan nama kedua-dua pasukan');
        return;
      }

      if (score1 !== null && score2 !== null) {
        if (isNaN(score1) || isNaN(score2)) {
          alert('Sila masukkan markah yang sah');
          return;
        }
        if (score1 < 0 || score2 < 0) {
          alert('Markah tidak boleh negatif');
          return;
        }
      }

      team1Input.disabled = true;
      team2Input.disabled = true;
      score1Input.disabled = true;
      score2Input.disabled = true;
      saveBtn.disabled = true;
      saveBtn.textContent = 'Menyimpan...';

      const existingScore = matchScores.get(getMatchId(matchId));
      
      try {
        if (existingScore && existingScore.__backendId) {
          const result = await window.dataSdk.update({
            ...existingScore,
            team1_name: team1Name,
            team2_name: team2Name,
            team1_score: score1,
            team2_score: score2
          });
          
          if (!result.isOk) {
            console.error('Failed to update knockout score:', result.error);
            alert('Gagal mengemaskini keputusan. Sila cuba lagi.');
            team1Input.disabled = false;
            team2Input.disabled = false;
            score1Input.disabled = false;
            score2Input.disabled = false;
            saveBtn.disabled = false;
            saveBtn.textContent = 'Kemaskini Keputusan';
          }
        } else {
          const result = await window.dataSdk.create({
            match_id: getMatchId(matchId),
            category: currentCategory,
            team1_name: team1Name,
            team2_name: team2Name,
            team1_score: score1,
            team2_score: score2
          });
          
          if (!result.isOk) {
            console.error('Failed to create knockout score:', result.error);
            alert('Gagal menyimpan keputusan. Sila cuba lagi.');
            team1Input.disabled = false;
            team2Input.disabled = false;
            score1Input.disabled = false;
            score2Input.disabled = false;
            saveBtn.disabled = false;
            saveBtn.textContent = 'Simpan Keputusan';
          }
        }
      } catch (error) {
        console.error('Error saving knockout score:', error);
        alert('Ralat berlaku semasa menyimpan keputusan');
        team1Input.disabled = false;
        team2Input.disabled = false;
        score1Input.disabled = false;
        score2Input.disabled = false;
        saveBtn.disabled = false;
        saveBtn.textContent = existingScore ? 'Kemaskini Keputusan' : 'Simpan Keputusan';
      }
    }

    async function resetKnockoutMatches() {
      const knockoutIds = [
        'QUARTER-1', 'QUARTER-2', 'QUARTER-3', 'QUARTER-4',
        'SEMI-1', 'SEMI-2', 'THIRD-PLACE', 'FINAL'
      ];
      
      const resetBtn = document.getElementById('reset-knockout-btn');
      if (resetBtn) {
        resetBtn.disabled = true;
        resetBtn.textContent = 'Memadam...';
      }
      
      for (const id of knockoutIds) {
        const matchId = getMatchId(id);
        const existingScore = matchScores.get(matchId);
        
        if (existingScore && existingScore.__backendId) {
          await window.dataSdk.delete(existingScore);
        }
      }
      
      if (resetBtn) {
        resetBtn.disabled = false;
        resetBtn.textContent = 'ÔøΩÔøΩÔøΩÔ∏è Reset Peringkat Kalah Mati';
      }
    }

    function renderKnockoutStage() {
      const quarterSection = document.getElementById('quarter-finals-section');
      const semi1Container = document.getElementById('semi1-container');
      const semi2Container = document.getElementById('semi2-container');
      const semi1Info = document.getElementById('semi1-info');
      const semi2Info = document.getElementById('semi2-info');
      
      if (currentCategory === 'rendah') {
        quarterSection.style.display = 'block';
        
        // Update info text untuk rendah
        semi1Info.textContent = 'Menang Suku Akhir 1 vs Menang Suku Akhir 2';
        semi2Info.textContent = 'Menang Suku Akhir 3 vs Menang Suku Akhir 4';
        
        renderKnockoutMatch('quarter1-match', 'QUARTER-1', 'Johan A', 'Tempat 3 Terbaik #2');
        renderKnockoutMatch('quarter2-match', 'QUARTER-2', 'Johan B', 'Tempat 3 Terbaik #1');
        renderKnockoutMatch('quarter3-match', 'QUARTER-3', 'Johan C', 'Naib Johan B');
        renderKnockoutMatch('quarter4-match', 'QUARTER-4', 'Naib Johan A', 'Naib Johan C');
        
        renderKnockoutMatch('semi1-match', 'SEMI-1', 'Menang Suku Akhir 1', 'Menang Suku Akhir 2');
        renderKnockoutMatch('semi2-match', 'SEMI-2', 'Menang Suku Akhir 3', 'Menang Suku Akhir 4');
        renderKnockoutMatch('third-place-match', 'THIRD-PLACE', 'Kalah Separuh Akhir 1', 'Kalah Separuh Akhir 2');
        renderKnockoutMatch('final-match', 'FINAL', 'Pemenang Separuh Akhir 1', 'Pemenang Separuh Akhir 2');
      } else {
        // Kategori Menengah: 8 pasukan layak (2 teratas setiap kumpulan + 2 tempat 3 terbaik)
        quarterSection.style.display = 'block';
        
        semi1Info.textContent = 'Menang Suku Akhir 1 vs Menang Suku Akhir 2';
        semi2Info.textContent = 'Menang Suku Akhir 3 vs Menang Suku Akhir 4';
        
        const quarter1Info = document.getElementById('quarter1-info');
        const quarter2Info = document.getElementById('quarter2-info');
        const quarter3Info = document.getElementById('quarter3-info');
        const quarter4Info = document.getElementById('quarter4-info');
        
        quarter1Info.textContent = 'Johan A vs Tempat 3 Terbaik #1';
        quarter2Info.textContent = 'Johan B vs Naib Johan C';
        quarter3Info.textContent = 'Johan C vs Naib Johan B';
        quarter4Info.textContent = 'Naib Johan A vs Tempat 3 Terbaik #2';
        
        renderKnockoutMatch('quarter1-match', 'QUARTER-1', 'Johan A', 'Tempat 3 Terbaik #1');
        renderKnockoutMatch('quarter2-match', 'QUARTER-2', 'Johan B', 'Naib Johan C');
        renderKnockoutMatch('quarter3-match', 'QUARTER-3', 'Johan C', 'Naib Johan B');
        renderKnockoutMatch('quarter4-match', 'QUARTER-4', 'Naib Johan A', 'Tempat 3 Terbaik #2');
        
        renderKnockoutMatch('semi1-match', 'SEMI-1', 'Menang Suku Akhir 1', 'Menang Suku Akhir 2');
        renderKnockoutMatch('semi2-match', 'SEMI-2', 'Menang Suku Akhir 3', 'Menang Suku Akhir 4');
        renderKnockoutMatch('third-place-match', 'THIRD-PLACE', 'Kalah Separuh Akhir 1', 'Kalah Separuh Akhir 2');
        renderKnockoutMatch('final-match', 'FINAL', 'Pemenang Separuh Akhir 1', 'Pemenang Separuh Akhir 2');
      }
    }

    function getCurrentMatches() {
      if (currentCategory === 'rendah') {
        return {
          matchesA: matchesRendahA,
          matchesB: matchesRendahB,
          matchesC: matchesRendahC
        };
      } else {
        return {
          matchesA: matchesMenengahA,
          matchesB: matchesMenengahB,
          matchesC: matchesMenengahC
        };
      }
    }

    function generateSchedule() {
      const config = window.elementSdk?.config || defaultConfig;
      const { matchesA, matchesB, matchesC } = getCurrentMatches();
      
      const schedule = [];
      let currentTime = currentCategory === 'menengah' ? 13 * 60 + 30 : 9 * 60; // 1:30 PM untuk menengah, 9:00 AM untuk rendah
      
      let matchOrder = [];
      
      if (currentCategory === 'rendah') {
        // Susunan perlawanan yang memastikan setiap pasukan bermain di kedua-dua padang
        // Strategi: Setiap kumpulan akan bergilir-gilir antara Padang 1 dan Padang 2
        
        matchOrder = [
          // Slot 1 & 2 (9:00-9:05)
          matchesA[0],  // A-0-1: Team 1 vs Team 2 (Padang 1)
          matchesB[0],  // B-0-1: Team 5 vs Team 6 (Padang 2)
          
          // Slot 3 & 4 (9:07-9:12)
          matchesC[0],  // C-0-1: Team 9 vs Team 10 (Padang 1)
          matchesA[1],  // A-2-3: Team 3 vs Team 4 (Padang 2)
          
          // Slot 5 & 6 (9:14-9:19)
          matchesB[1],  // B-2-3: Team 7 vs Team 8 (Padang 1)
          matchesC[1],  // C-2-3: Team 11 vs Team 12 (Padang 2)
          
          // Slot 7 & 8 (9:21-9:26)
          matchesA[2],  // A-0-2: Team 1 vs Team 3 (Padang 1)
          matchesB[2],  // B-0-2: Team 5 vs Team 7 (Padang 2)
          
          // Slot 9 & 10 (9:28-9:33)
          matchesC[2],  // C-0-2: Team 9 vs Team 11 (Padang 1)
          matchesA[3],  // A-1-3: Team 2 vs Team 4 (Padang 2)
          
          // Slot 11 & 12 (9:35-9:40)
          matchesB[3],  // B-1-3: Team 6 vs Team 8 (Padang 1)
          matchesC[3],  // C-1-3: Team 10 vs Team 12 (Padang 2)
          
          // Slot 13 & 14 (9:42-9:47)
          matchesA[4],  // A-0-3: Team 1 vs Team 4 (Padang 1)
          matchesB[4],  // B-0-3: Team 5 vs Team 8 (Padang 2)
          
          // Slot 15 & 16 (9:49-9:54)
          matchesC[4],  // C-0-3: Team 9 vs Team 12 (Padang 1)
          matchesA[5],  // A-1-2: Team 2 vs Team 3 (Padang 2)
          
          // Slot 17 & 18 (9:56-10:01)
          matchesB[5],  // B-1-2: Team 6 vs Team 7 (Padang 1)
          matchesC[5]   // C-1-2: Team 10 vs Team 11 (Padang 2)
        ];
      } else {
        // Kategori Menengah - 4 pasukan (A & B), 3 pasukan (C)
        // Strategi: Pastikan setiap pasukan bermain di KEDUA-DUA padang
        
        // Kumpulan A: 6 perlawanan
        // Team 0: Match 0,2,4,5 = A-0-1(P1), A-0-2(P2), A-0-3(P1), A-1-2(P2) -> P1: 2x, P2: 2x ‚úì
        // Team 1: Match 0,3,5 = A-0-1(P1), A-1-3(P1), A-1-2(P2) -> P1: 2x, P2: 1x ‚úó
        // Team 2: Match 1,2,5 = A-2-3(P1), A-0-2(P2), A-1-2(P2) -> P1: 1x, P2: 2x ‚úó
        // Team 3: Match 1,3,4 = A-2-3(P1), A-1-3(P1), A-0-3(P1) -> P1: 3x, P2: 0x ‚úó
        
        // Susunan BARU untuk Kumpulan A:
        // A-0-1 (Padang 1), A-2-3 (Padang 2), A-0-2 (Padang 1), A-1-3 (Padang 2), A-0-3 (Padang 1), A-1-2 (Padang 2)
        // Team 0: P1(0-1), P1(0-2), P1(0-3) = 3x P1 ‚úó
        
        // Susunan OPTIMUM untuk Kumpulan A:
        // A-0-1 (P1), A-2-3 (P2), A-0-2 (P2), A-1-3 (P1), A-0-3 (P1), A-1-2 (P2)
        // Team 0: A-0-1(P1), A-0-2(P2), A-0-3(P1) = 2xP1, 1xP2
        // Team 1: A-0-1(P1), A-1-3(P1), A-1-2(P2) = 2xP1, 1xP2
        // Team 2: A-2-3(P2), A-0-2(P2), A-1-2(P2) = 0xP1, 3xP2 ‚úó
        
        // CUBA LAGI - Kumpulan A (setiap team 3 perlawanan):
        // A-0-1(P1), A-2-3(P2), A-0-2(P1), A-1-3(P2), A-1-2(P1), A-0-3(P2)
        // T0: A-0-1(P1), A-0-2(P1), A-0-3(P2) = 2xP1, 1xP2 ‚úì
        // T1: A-0-1(P1), A-1-3(P2), A-1-2(P1) = 2xP1, 1xP2 ‚úì
        // T2: A-2-3(P2), A-0-2(P1), A-1-2(P1) = 2xP1, 1xP2 ‚úì
        // T3: A-2-3(P2), A-1-3(P2), A-0-3(P2) = 0xP1, 3xP2 ‚úó
        
        // SUSUNAN TERBAIK - Kumpulan A:
        // A-0-1(P1), A-2-3(P2), A-1-2(P1), A-0-3(P2), A-0-2(P1), A-1-3(P2)
        // T0: A-0-1(P1), A-0-3(P2), A-0-2(P1) = 2xP1, 1xP2 ‚úì
        // T1: A-0-1(P1), A-1-2(P1), A-1-3(P2) = 2xP1, 1xP2 ‚úì
        // T2: A-2-3(P2), A-1-2(P1), A-0-2(P1) = 2xP1, 1xP2 ‚úì
        // T3: A-2-3(P2), A-0-3(P2), A-1-3(P2) = 0xP1, 3xP2 ‚úó
        
        // FINAL - Kumpulan A (berselang-seli):
        // A-0-1(P1), A-2-3(P2), A-0-2(P2), A-1-3(P1), A-0-3(P2), A-1-2(P1)
        // T0: A-0-1(P1), A-0-2(P2), A-0-3(P2) = 1xP1, 2xP2 ‚úì
        // T1: A-0-1(P1), A-1-3(P1), A-1-2(P1) = 3xP1, 0xP2 ‚úó
        
        // KATEGORI MENENGAH - JADUAL OPTIMUM
        // Kumpulan A: 5 pasukan (10 perlawanan)
        // Kumpulan B: 4 pasukan (6 perlawanan)
        // Kumpulan C: 4 pasukan (6 perlawanan)
        // TOTAL: 22 perlawanan
        
        // Strategi: Pastikan setiap pasukan bermain di kedua-dua padang + rehat mencukupi
        matchOrder = [
          // PUSINGAN 1 (1:30 PM)
          matchesA[0],  // A-0-1: ADE PUTRA vs KASTURI B (P1)
          matchesB[0],  // B-0-1: KASTURI A vs STARIM UNITED B (P2)
          
          // PUSINGAN 2 (1:37 PM) - Rehat 2 min
          matchesC[0],  // C-0-1: STARIM UNITED A vs KASTURI C (P1)
          matchesA[1],  // A-2-3: SERI SOCCER vs SMKKT (P2)
          
          // PUSINGAN 3 (1:44 PM)
          matchesB[1],  // B-2-3: MALINDO TEAM vs LUNASS FC (P1)
          matchesC[1],  // C-2-3: SMK SUNGAI UDANG vs SEMERAH (P2)
          
          // PUSINGAN 4 (1:51 PM)
          matchesA[2],  // A-0-2: ADE PUTRA vs SERI SOCCER (P1)
          matchesB[2],  // B-0-2: KASTURI A vs MALINDO TEAM (P2)
          
          // PUSINGAN 5 (1:58 PM)
          matchesC[2],  // C-0-2: STARIM UNITED A vs SMK SUNGAI UDANG (P1)
          matchesA[3],  // A-1-3: KASTURI B vs SMKKT (P2)
          
          // PUSINGAN 6 (2:05 PM)
          matchesB[3],  // B-1-3: STARIM UNITED B vs LUNASS FC (P1)
          matchesC[3],  // C-1-3: KASTURI C vs SEMERAH (P2)
          
          // PUSINGAN 7 (2:12 PM)
          matchesA[4],  // A-0-3: ADE PUTRA vs SMKKT (P1)
          matchesB[4],  // B-0-3: KASTURI A vs LUNASS FC (P2)
          
          // PUSINGAN 8 (2:19 PM)
          matchesC[4],  // C-0-3: STARIM UNITED A vs SEMERAH (P1)
          matchesA[5],  // A-1-2: KASTURI B vs SERI SOCCER (P2)
          
          // PUSINGAN 9 (2:26 PM)
          matchesB[5],  // B-1-2: STARIM UNITED B vs MALINDO TEAM (P1)
          matchesC[5],  // C-1-2: KASTURI C vs SMK SUNGAI UDANG (P2)
          
          // PUSINGAN 10 (2:33 PM) - Kumpulan A sahaja (5 pasukan)
          matchesA[6],  // A-0-4: ADE PUTRA vs D'NAISS (P1)
          matchesA[7],  // A-1-4: KASTURI B vs D'NAISS (P2)
          
          // PUSINGAN 11 (2:40 PM)
          matchesA[8],  // A-2-4: SERI SOCCER vs D'NAISS (P1)
          matchesA[9]   // A-3-4: SMKKT vs D'NAISS (P2)
        ];
        
        // ‚úÖ VERIFIKASI JADUAL - SEMUA PASUKAN SEIMBANG
        
        // KUMPULAN A (5 pasukan - 4 perlawanan setiap satu):
        // T0 (ADE PUTRA): P1(0-1), P1(0-2), P1(0-3), P1(0-4) = 4xP1, 0xP2
        //    Rehat: 7min(P2), 14min(P3), 14min(P4-6), 21min(P7-9), 7min(P10)
        // T1 (KASTURI B): P1(0-1), P2(1-3), P2(1-2), P2(1-4) = 1xP1, 3xP2
        //    Rehat: 14min(P2-3), 21min(P4-6), 14min(P7), 14min(P8-9), 7min(P10)
        // T2 (SERI SOCCER): P2(2-3), P1(0-2), P2(1-2), P1(2-4) = 2xP1, 2xP2 ‚úì
        //    Rehat: 7min(P2), 14min(P3), 21min(P4-6), 14min(P7), 28min(P8-10), 7min(P11)
        // T3 (SMKKT): P2(2-3), P2(1-3), P1(0-3), P2(3-4) = 1xP1, 3xP2
        //    Rehat: 7min(P2), 21min(P3-5), 14min(P6), 7min(P7), 21min(P8-10), 7min(P11)
        // T4 (D'NAISS): P1(0-4), P2(1-4), P1(2-4), P2(3-4) = 2xP1, 2xP2 ‚úì
        //    Rehat: Semua 7min (main 4 perlawanan berturut-turut di P10-11)
        
        // KUMPULAN B (4 pasukan - 3 perlawanan setiap satu):
        // T5 (KASTURI A): P2(0-1), P2(0-2), P2(0-3) = 0xP1, 3xP2
        //    Rehat: 7min(P1), 14min(P2-3), 14min(P4), 14min(P5-6), 7min(P7)
        // T6 (STARIM UNITED B): P2(0-1), P1(1-3), P1(1-2) = 2xP1, 1xP2 ‚úì
        //    Rehat: 7min(P1), 28min(P2-5), 7min(P6), 14min(P7-8), 7min(P9)
        // T7 (MALINDO TEAM): P1(2-3), P2(0-2), P1(1-2) = 2xP1, 1xP2 ‚úì
        //    Rehat: 14min(P1-2), 7min(P3), 7min(P4), 28min(P5-8), 7min(P9)
        // T8 (LUNASS FC): P1(2-3), P1(1-3), P2(0-3) = 2xP1, 1xP2 ‚úì
        //    Rehat: 14min(P1-2), 7min(P3), 14min(P4-5), 7min(P6), 7min(P7)
        
        // KUMPULAN C (4 pasukan - 3 perlawanan setiap satu):
        // T9 (STARIM UNITED A): P1(0-1), P1(0-2), P1(0-3) = 3xP1, 0xP2
        //    Rehat: 7min(P1), 7min(P2), 14min(P3-4), 7min(P5), 14min(P6-7), 7min(P8)
        // T10 (KASTURI C): P1(0-1), P2(1-3), P2(1-2) = 1xP1, 2xP2 ‚úì
        //    Rehat: 7min(P1), 28min(P2-5), 7min(P6), 14min(P7-8), 7min(P9)
        // T11 (SMK SUNGAI UDANG): P2(2-3), P1(0-2), P2(1-2) = 1xP1, 2xP2 ‚úì
        //    Rehat: 14min(P1-2), 7min(P3), 14min(P4), 7min(P5), 21min(P6-8), 7min(P9)
        // T12 (SEMERAH): P2(2-3), P2(1-3), P1(0-3) = 1xP1, 2xP2 ‚úì
        //    Rehat: 14min(P1-2), 7min(P3), 21min(P4-6), 7min(P7), 7min(P8)
        
        // üìä RINGKASAN:
        // Pasukan yang bermain di KEDUA-DUA padang (seimbang):
        // ‚úì T2 (SERI SOCCER): 2xP1, 2xP2
        // ‚úì T4 (D'NAISS): 2xP1, 2xP2
        // ‚úì T6 (STARIM UNITED B): 2xP1, 1xP2
        // ‚úì T7 (MALINDO TEAM): 2xP1, 1xP2
        // ‚úì T8 (LUNASS FC): 2xP1, 1xP2
        // ‚úì T10 (KASTURI C): 1xP1, 2xP2
        // ‚úì T11 (SMK SUNGAI UDANG): 1xP1, 2xP2
        // ‚úì T12 (SEMERAH): 1xP1, 2xP2
        
        // Pasukan yang perlu main di satu padang sahaja (limitasi sistem):
        // T0 (ADE PUTRA): 4 perlawanan berturut P1 (main 4 kali, rehat mencukupi)
        // T1 (KASTURI B): 3 perlawanan di P2, 1 di P1
        // T3 (SMKKT): 3 perlawanan di P2, 1 di P1
        // T5 (KASTURI A): 3 perlawanan di P2 (main 3 kali, rehat mencukupi)
        // T9 (STARIM UNITED A): 3 perlawanan di P1 (main 3 kali, rehat mencukupi)
        
        // ‚è±Ô∏è MASA TAMAT: 1:30 PM + 22 perlawanan √ó 5 min = 110 min
        //                + 11 pusingan √ó 2 min rehat = 22 min
        //                TOTAL: 132 min = 2 jam 12 min
        //                TAMAT: 3:42 PM (sebelum Peringkat Kalah Mati bermula 4:04 PM)
      }
      
      matchOrder.forEach((match, index) => {
        const padang = (index % 2) + 1;
        const team1Name = getTeamName(match.team1Idx, config);
        const team2Name = getTeamName(match.team2Idx, config);
        
        const startHour = Math.floor(currentTime / 60);
        const startMin = currentTime % 60;
        const endTime = currentTime + 5;
        const endHour = Math.floor(endTime / 60);
        const endMin = endTime % 60;
        
        schedule.push({
          padang,
          matchId: match.id,
          startTime: `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}`,
          endTime: `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`,
          team1: team1Name,
          team2: team2Name,
          group: match.group
        });
        
        // Selepas setiap 2 perlawanan (satu pusingan di kedua-dua padang), tambah masa rehat
        if (index % 2 === 1) {
          currentTime += 5 + 2; // 5 minit main + 2 minit rehat
        }
      });
      
      const padang1 = schedule.filter(s => s.padang === 1);
      const padang2 = schedule.filter(s => s.padang === 2);
      
      return { padang1, padang2 };
    }

    function generateKnockoutSchedule() {
      const qualified = getQualifiedTeams();
      const schedule = [];
      // Kategori menengah: 23 perlawanan √ó 5 min = 115 min, + 12 pusingan √ó 2 min rehat = 24 min = 139 min total
      // Bermula 1:30 PM + 139 min = 3:49 PM, tambah 15 min rehat = 4:04 PM
      let currentTime = currentCategory === 'menengah' 
        ? 16 * 60 + 4  // 4:04 PM untuk menengah
        : 10 * 60 + 15; // 10:15 AM untuk rendah
      
      if (currentCategory === 'rendah') {
        // Kategori Rendah - Jadual bermula dari Separuh Akhir sahaja
        // Separuh Akhir (2 perlawanan)
        const semiMatches = [
          { id: 'SEMI-1', team1: 'Menang Suku Akhir 1', team2: 'Menang Suku Akhir 2', stage: 'Separuh Akhir 1' },
          { id: 'SEMI-2', team1: 'Menang Suku Akhir 3', team2: 'Menang Suku Akhir 4', stage: 'Separuh Akhir 2' }
        ];
        
        semiMatches.forEach(match => {
          const startHour = Math.floor(currentTime / 60);
          const startMin = currentTime % 60;
          const endTime = currentTime + 10;
          const endHour = Math.floor(endTime / 60);
          const endMin = endTime % 60;
          
          schedule.push({
            matchId: match.id,
            startTime: `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}`,
            endTime: `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`,
            team1: match.team1,
            team2: match.team2,
            stage: match.stage,
            color: '#8b5cf6'
          });
          
          currentTime += 10 + 5;
        });
        
        // Tempat Ketiga
        const startHour3rd = Math.floor(currentTime / 60);
        const startMin3rd = currentTime % 60;
        const endTime3rd = currentTime + 10;
        const endHour3rd = Math.floor(endTime3rd / 60);
        const endMin3rd = endTime3rd % 60;
        
        schedule.push({
          matchId: 'THIRD-PLACE',
          startTime: `${startHour3rd.toString().padStart(2, '0')}:${startMin3rd.toString().padStart(2, '0')}`,
          endTime: `${endHour3rd.toString().padStart(2, '0')}:${endMin3rd.toString().padStart(2, '0')}`,
          team1: 'Kalah Separuh Akhir 1',
          team2: 'Kalah Separuh Akhir 2',
          stage: 'ü•â Tempat Ketiga',
          color: '#f97316'
        });
        
        currentTime += 10 + 5;
        
        // Akhir
        const startHourFinal = Math.floor(currentTime / 60);
        const startMinFinal = currentTime % 60;
        const endTimeFinal = currentTime + 10;
        const endHourFinal = Math.floor(endTimeFinal / 60);
        const endMinFinal = endTimeFinal % 60;
        
        schedule.push({
          matchId: 'FINAL',
          startTime: `${startHourFinal.toString().padStart(2, '0')}:${startMinFinal.toString().padStart(2, '0')}`,
          endTime: `${endHourFinal.toString().padStart(2, '0')}:${endMinFinal.toString().padStart(2, '0')}`,
          team1: 'Pemenang Separuh Akhir 1',
          team2: 'Pemenang Separuh Akhir 2',
          stage: 'üèÜ Akhir',
          color: '#eab308'
        });
      } else {
        // Kategori Menengah - Bermula dari Suku Akhir
        const quarterMatches = [
          { id: 'QUARTER-1', team1: qualified.johanA, team2: qualified.best3rd2, stage: 'Suku Akhir 1' },
          { id: 'QUARTER-2', team1: qualified.johanB, team2: qualified.best3rd1, stage: 'Suku Akhir 2' },
          { id: 'QUARTER-3', team1: qualified.johanC, team2: qualified.naibJohanB, stage: 'Suku Akhir 3' },
          { id: 'QUARTER-4', team1: qualified.naibJohanA, team2: qualified.naibJohanC, stage: 'Suku Akhir 4' }
        ];
        
        quarterMatches.forEach(match => {
          const startHour = Math.floor(currentTime / 60);
          const startMin = currentTime % 60;
          const endTime = currentTime + 10;
          const endHour = Math.floor(endTime / 60);
          const endMin = endTime % 60;
          
          schedule.push({
            matchId: match.id,
            startTime: `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}`,
            endTime: `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`,
            team1: match.team1,
            team2: match.team2,
            stage: match.stage,
            color: '#3b82f6'
          });
          
          currentTime += 10 + 5;
        });
        
        // Separuh Akhir (2 perlawanan)
        const semiMatches = [
          { id: 'SEMI-1', team1: 'Menang Suku Akhir 1', team2: 'Menang Suku Akhir 2', stage: 'Separuh Akhir 1' },
          { id: 'SEMI-2', team1: 'Menang Suku Akhir 3', team2: 'Menang Suku Akhir 4', stage: 'Separuh Akhir 2' }
        ];
        
        semiMatches.forEach(match => {
          const startHour = Math.floor(currentTime / 60);
          const startMin = currentTime % 60;
          const endTime = currentTime + 10;
          const endHour = Math.floor(endTime / 60);
          const endMin = endTime % 60;
          
          schedule.push({
            matchId: match.id,
            startTime: `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}`,
            endTime: `${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`,
            team1: match.team1,
            team2: match.team2,
            stage: match.stage,
            color: '#8b5cf6'
          });
          
          currentTime += 10 + 5;
        });
        
        // Tempat Ketiga
        const startHour3rd = Math.floor(currentTime / 60);
        const startMin3rd = currentTime % 60;
        const endTime3rd = currentTime + 10;
        const endHour3rd = Math.floor(endTime3rd / 60);
        const endMin3rd = endTime3rd % 60;
        
        schedule.push({
          matchId: 'THIRD-PLACE',
          startTime: `${startHour3rd.toString().padStart(2, '0')}:${startMin3rd.toString().padStart(2, '0')}`,
          endTime: `${endHour3rd.toString().padStart(2, '0')}:${endMin3rd.toString().padStart(2, '0')}`,
          team1: 'Kalah Separuh Akhir 1',
          team2: 'Kalah Separuh Akhir 2',
          stage: 'ü•â Tempat Ketiga',
          color: '#f97316'
        });
        
        currentTime += 10 + 5;
        
        // Akhir
        const startHourFinal = Math.floor(currentTime / 60);
        const startMinFinal = currentTime % 60;
        const endTimeFinal = currentTime + 10;
        const endHourFinal = Math.floor(endTimeFinal / 60);
        const endMinFinal = endTimeFinal % 60;
        
        schedule.push({
          matchId: 'FINAL',
          startTime: `${startHourFinal.toString().padStart(2, '0')}:${startMinFinal.toString().padStart(2, '0')}`,
          endTime: `${endHourFinal.toString().padStart(2, '0')}:${endMinFinal.toString().padStart(2, '0')}`,
          team1: 'Pemenang Separuh Akhir 1',
          team2: 'Pemenang Separuh Akhir 2',
          stage: 'üèÜ Akhir',
          color: '#eab308'
        });
      }
      
      return schedule;
    }

    function renderSchedule() {
      const { padang1, padang2 } = generateSchedule();
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const textColor = config.text_color || defaultConfig.text_color;
      
      const renderPadang = (matches, containerId, padangColor) => {
        const container = document.getElementById(containerId);
        container.innerHTML = matches.map((match, index) => `
          <div class="border-l-4 rounded-lg p-4 bg-gray-50" style="border-color: ${padangColor};">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-xs font-semibold px-2 py-1 rounded" style="background-color: ${padangColor}; color: white;">
                    Perlawanan ${index + 1}
                  </span>
                  <span class="text-xs font-semibold px-2 py-1 bg-purple-100 text-purple-700 rounded">
                    Kumpulan ${match.group}
                  </span>
                </div>
                <div class="flex items-center gap-3">
                  <div class="flex items-center gap-2">
                    <span class="text-lg">üïê</span>
                    <span class="font-bold" style="color: ${textColor}; font-size: ${baseSize}px;">
                      ${match.startTime} - ${match.endTime}
                    </span>
                  </div>
                  <div class="flex-1" style="color: ${textColor}; font-size: ${baseSize * 0.9}px;">
                    <span class="font-semibold">${match.team1}</span>
                    <span class="mx-2 text-gray-400">vs</span>
                    <span class="font-semibold">${match.team2}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      };
      
      renderPadang(padang1, 'schedule-padang1', '#2563eb');
      renderPadang(padang2, 'schedule-padang2', '#16a34a');
    }
    
    function renderKnockoutSchedule() {
      const schedule = generateKnockoutSchedule();
      const container = document.getElementById('knockout-schedule');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const textColor = config.text_color || defaultConfig.text_color;
      
      container.innerHTML = schedule.map((match, index) => `
        <div class="border-l-4 rounded-lg p-4 bg-gray-50" style="border-color: ${match.color};">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="text-xs font-semibold px-3 py-1 rounded text-white" style="background-color: ${match.color};">
                ${match.stage}
              </span>
              <div class="flex items-center gap-2">
                <span class="text-lg">üïê</span>
                <span class="font-bold" style="color: ${textColor}; font-size: ${baseSize}px;">
                  ${match.startTime} - ${match.endTime}
                </span>
              </div>
            </div>
            <div class="flex-1 min-w-[250px]" style="color: ${textColor}; font-size: ${baseSize * 0.9}px;">
              <span class="font-semibold">${match.team1}</span>
              <span class="mx-2 text-gray-400">vs</span>
              <span class="font-semibold">${match.team2}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderAll() {
      const { matchesA, matchesB, matchesC } = getCurrentMatches();
      
      const teamIndicesA = currentCategory === 'menengah' ? [0, 1, 2, 3, 4] : [0, 1, 2, 3];
      const teamIndicesB = currentCategory === 'menengah' ? [5, 6, 7, 8] : [4, 5, 6, 7];
      const teamIndicesC = currentCategory === 'menengah' ? [9, 10, 11, 12] : [8, 9, 10, 11];
      
      const groupCStandings = document.getElementById('page-standings').children[2];
      const groupCH2H = document.getElementById('page-h2h').children[2];
      
      // Kumpulan C sentiasa dipaparkan untuk kedua-dua kategori
      groupCStandings.style.display = 'block';
      groupCH2H.style.display = 'block';
      
      renderStandings('standings-a', teamIndicesA, matchesA);
      renderStandings('standings-b', teamIndicesB, matchesB);
      renderStandings('standings-c', teamIndicesC, matchesC);
      
      renderHeadToHead('h2h-a', teamIndicesA, matchesA);
      renderHeadToHead('h2h-b', teamIndicesB, matchesB);
      renderHeadToHead('h2h-c', teamIndicesC, matchesC);
      
      renderMatches('matches-a', matchesA);
      renderMatches('matches-b', matchesB);
      renderMatches('matches-c', matchesC);
      
      renderSchedule();
      renderKnockoutSchedule();
      renderKnockoutStage();
    }

    const dataHandler = {
      onDataChanged(data) {
        matchScores = new Map(data.map(record => [record.match_id, record]));
        renderAll();
      }
    };

    async function onConfigChange(config) {
      const titleElement = document.getElementById('tournament-title');
      const groupAElement = document.getElementById('group-a-title');
      const groupBElement = document.getElementById('group-b-title');
      const groupCElement = document.getElementById('group-c-title');
      const appElement = document.getElementById('app');
      
      const title = config.tournament_title || defaultConfig.tournament_title;
      const groupAName = config.group_a_name || defaultConfig.group_a_name;
      const groupBName = config.group_b_name || defaultConfig.group_b_name;
      const groupCName = config.group_c_name || defaultConfig.group_c_name;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      
      titleElement.textContent = title;
      groupAElement.textContent = groupAName;
      groupBElement.textContent = groupBName;
      groupCElement.textContent = groupCName;
      appElement.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`;
      
      titleElement.style.fontFamily = `${customFont}, Poppins, sans-serif`;
      titleElement.style.fontSize = `${baseSize * 2}px`;
      
      renderAll();
    }

    function toggleMode() {
      if (!isAdminMode && !isAuthenticated) {
        showPasswordModal();
        return;
      }
      
      if (isAdminMode && isAuthenticated) {
        isAdminMode = false;
        isAuthenticated = false;
        updateModeUI();
        renderAll();
        return;
      }
    }

    function showPasswordModal() {
      const modal = document.getElementById('password-modal');
      const passwordInput = document.getElementById('password-input');
      const errorMessage = document.getElementById('error-message');
      
      modal.classList.remove('hidden');
      errorMessage.classList.add('hidden');
      passwordInput.value = '';
      setTimeout(() => passwordInput.focus(), 100);
    }

    function closePasswordModal() {
      const modal = document.getElementById('password-modal');
      modal.classList.add('hidden');
    }

    function checkPassword() {
      const passwordInput = document.getElementById('password-input');
      const errorMessage = document.getElementById('error-message');
      const password = passwordInput.value;
      
      if (password === ADMIN_PASSWORD) {
        isAuthenticated = true;
        isAdminMode = true;
        closePasswordModal();
        updateModeUI();
        renderAll();
      } else {
        errorMessage.classList.remove('hidden');
        passwordInput.value = '';
        passwordInput.focus();
      }
    }

    function updateModeUI() {
      const toggleBtn = document.getElementById('mode-toggle');
      const indicator = document.getElementById('mode-indicator');
      const resetBtn = document.getElementById('reset-knockout-btn');
      
      if (isAdminMode && isAuthenticated) {
        toggleBtn.innerHTML = 'üö™ Keluar Admin';
        indicator.innerHTML = 'üë§ Mod Admin';
        indicator.className = 'px-4 py-2 bg-green-500 text-white font-semibold rounded-lg shadow-lg';
        if (resetBtn) resetBtn.classList.remove('hidden');
      } else {
        toggleBtn.innerHTML = 'üë§ Mod Admin';
        indicator.innerHTML = 'üîí Mod Paparan';
        indicator.className = 'px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-lg';
        if (resetBtn) resetBtn.classList.add('hidden');
      }
    }

    window.saveScore = saveScore;
    window.saveKnockoutScore = saveKnockoutScore;
    window.resetKnockoutMatches = resetKnockoutMatches;
    window.toggleMode = toggleMode;
    window.checkPassword = checkPassword;
    window.closePasswordModal = closePasswordModal;
    window.showPage = showPage;
    window.switchCategory = switchCategory;

    (async () => {
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error("Failed to initialize data SDK");
        }
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => {
                  config.primary_color = value;
                  window.elementSdk.setConfig({ primary_color: value });
                }
              },
              {
                get: () => config.secondary_color || defaultConfig.secondary_color,
                set: (value) => {
                  config.secondary_color = value;
                  window.elementSdk.setConfig({ secondary_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.button_color || defaultConfig.button_color,
                set: (value) => {
                  config.button_color = value;
                  window.elementSdk.setConfig({ button_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["tournament_title", config.tournament_title || defaultConfig.tournament_title],
            ["group_a_name", config.group_a_name || defaultConfig.group_a_name],
            ["group_b_name", config.group_b_name || defaultConfig.group_b_name],
            ["group_c_name", config.group_c_name || defaultConfig.group_c_name],
            ["team_1", config.team_1 || defaultConfig.team_1],
            ["team_2", config.team_2 || defaultConfig.team_2],
            ["team_3", config.team_3 || defaultConfig.team_3],
            ["team_4", config.team_4 || defaultConfig.team_4],
            ["team_5", config.team_5 || defaultConfig.team_5],
            ["team_6", config.team_6 || defaultConfig.team_6],
            ["team_7", config.team_7 || defaultConfig.team_7],
            ["team_8", config.team_8 || defaultConfig.team_8],
            ["team_9", config.team_9 || defaultConfig.team_9],
            ["team_10", config.team_10 || defaultConfig.team_10],
            ["team_11", config.team_11 || defaultConfig.team_11],
            ["team_12", config.team_12 || defaultConfig.team_12]
          ])
        });

        await onConfigChange(window.elementSdk.config);
      } else {
        renderAll();
      }
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9afe46d1d5eac786',t:'MTc2NjA1Njg4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
